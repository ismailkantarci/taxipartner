# React Migration – Legacy Module Inventory

This document captures the current legacy SPA modules, routes, and supporting assets that must be migrated into the React application. Each row highlights the legacy entrypoint, API surface, UI behaviour (lists, forms, validation, modals), and any permission/i18n considerations to account for during migration.

| Module | Legacy Route & Entrypoint | Legacy API & DTOs | UI, Forms & Validation | Permissions & i18n Notes |
| --- | --- | --- | --- | --- |
| Tenants | `#/tenants`<br>`frontend/tenants/routerAttach.ts` → `mountTenantsPage` (`frontend/tenants/page.ts`, styles in `page.css`) | `frontend/tenants/api.ts`<br>- `/tenants` GET list (q/status/page/pageSize/sort/order), POST create; `/tenants/{id}` PUT update<br>- `/tenants/{id}/users` POST assign user<br>- `/tenants/{id}/identity-history` GET<br>- `/corporate-actions` GET/POST<br>- `/tenants/{id}/identities`, `/shareholdings`, `/attachments`, `/officers`, `/vehicle-assignments`, `/driver-assignments`, `/approvals` (all GET list + POST create)<br>DTOs in `frontend/tenants/types.ts` (`TenantItem`, `Create*Input`, `TenantApprovalItem`, `ApiListResponse`, etc.) | Single-page layout with tenant list (search, status filter, sort, pagination) plus detail sections rendered into `.tenants-section` blocks.<br>Forms enforce: create tenant (`legalName`), assign user (`tenantId`,`userId`), identity add (`type`,`value`), corporate action (`actionType`,`effectiveDate`,`sourceTenantIds`), attachment (`ownerType`,`ownerId`,`attachmentType`,`fileRef`), shareholding (`roleType` and either existing `partyId` or new `partyType`+`partyName`), officer (`officerType`), vehicle assignment (`vehicleId`,`companyId`,`assignedFrom`), driver assignment (`party`/`company`/`assignedFrom`), approval (`scope`,`op`, JSON payload parsing). Lists render history, identifiers, corporate actions, attachments, shareholdings, officers, vehicles, drivers, approvals. | No explicit `RequirePermission`; optional `withMountGuard` fallback avoids double mount. Depends on `frontend/ui/activeTenant` and localStorage for tenant context. i18n keys live under `frontend/i18n/index.ts` (`tenant*`, `shareholding*`, `attachment*`, `approval*`); error copy via `ctx.showError`. |
| Companies | `#/companies`<br>`frontend/companies/routerAttach.ts` → `mountCompaniesPage` (`frontend/companies/page.ts`) | `frontend/companies/api.ts`<br>- `/tenants/{tenantId}/companies` GET list (q/page/pageSize/sort/order)<br>- `/companies` POST create; `/companies/{id}` GET/PUT/DELETE<br>- `/companies/{id}/officers` POST + DELETE; `/shareholders`, `/documents` add/remove<br>- `/companies/{id}/permits` GET/POST/PUT; `/permits/{permitId}/events` POST; `/vehicles` POST + `/vehicles/{authorizationId}/revoke` POST<br>- `listPermits` helper for detail fetches | Two-column layout (list + detail) with manual DOM rendering.<br>Left rail handles search, sort, CSV export, creation form (`companyId`,`legalName`,`address`).<br>Detail panel supports update/delete, officers list with add (`type` required, optional user/dates) and remove, shareholders add (`personName`,`roleType`, numeric check on percent) and remove, documents add (`title`,`docType`, optional URL, JSON meta), permits CRUD (`permitType` required, capacity numeric 0–9, status select), permit events (`eventType`,`eventDate`), vehicle authorizations (`vin` required, revoke action). | Uses `withMountGuard` when available; enforces active tenant selection. i18n keys under `company*`, `permit*`, `tenant*`; error messages surface via translation fallbacks. LocalStorage keys (`STORAGE_KEY_COMPANIES_STATE`, `STORAGE_KEY_ACTIVE_TENANT`) persist filters. |
| Organizations | `#/organizations`<br>`frontend/organizations/routerAttach.ts` → `mountOrganizationsPage` (`frontend/organizations/page.ts`) | `frontend/organizations/api.ts`<br>- `/tenants/{tenantId}/organizations` GET list (q/status/page/pageSize/sort/order)<br>- `/tenants/{tenantId}/organizations` POST create<br>- `/tenants/{tenantId}/organizations/{id}` GET/PUT/DELETE<br>Returns rich detail objects (mandate summaries, metaJson). | Page with list filters (search, status, sort, pagination). Create form requires `name`, optional `orgType`,`status`,`parentId`,`companyId`,`validFrom/To`,`description`,`metaJson` (JSON validation). Detail pane edits same payload, shows linked mandates, allows delete (backend rejections map to error codes). Parent select populated from cached hierarchy. | Mount guard pattern + active tenant requirement. Error codes mapped to `organizations.error.*` translation keys. i18n strings concentrated under `organizations.*`; existing copy mixes German/Turkish fallbacks. |
| Org Units (OUs) | `#/ous`<br>`frontend/ous/routerAttach.ts` → `mountOUsPage` (`frontend/ous/page.ts`) | `frontend/ous/api.ts`<br>- `/tenants/{tenantId}/ous` GET list (q/page/pageSize/sort/order)<br>- `/tenants/{tenantId}/ous` POST create<br>- `/tenants/{tenantId}/ous/{id}` GET/PUT/DELETE | Grid-based list with search + pagination; create form requires `name`, optional `parentId`. Detail view fetches selected OU, allows rename (`name` validation) and parent reassignment, renders children summary, delete action guarded by backend (cannot remove with children). | Uses `withMountGuard` + active tenant guard. Error codes translated via `ous.error.*`. i18n keys limited (`ous.*`); UI shares `tp-*` styling. |
| Mandates | `#/mandates`<br>`frontend/mandates/routerAttach.ts` → `mountMandatesPage` (`frontend/mandates/page.ts`) | `frontend/mandates/api.ts`<br>- `/tenants/{tenantId}/mandates` GET list (q/status/organization/page/pageSize/sort/order)<br>- `/tenants/{tenantId}/mandates` POST create<br>- `/tenants/{tenantId}/mandates/{id}` GET/PUT/DELETE | List with filters (search, status, organization) persisted via `STORAGE_KEY_STATE`. Create form requires `title` and `mandateType`, optional `status`,`organizationId`,`companyId`,`validFrom/To`,`notes`,`metaJson` (JSON parsing). Detail pane allows edit/delete with same validation, displays metadata and timestamps. | Guarded by active tenant; optional `withMountGuard`. Backend error codes mapped through `MANDATE_ERROR_I18N` to `mandates.error.*` strings. i18n copy partially localized (TR/DE mix). |
| Vehicles | `#/vehicles`<br>`frontend/vehicles/routerAttach.ts` → `mountVehiclesPage` (`frontend/vehicles/page.ts`) | `frontend/vehicles/api.ts`<br>- `/tenants/{tenantId}/vehicles` GET list (q/companyId/status/page/pageSize/sort/order)<br>- `/tenants/{tenantId}/vehicles` POST create<br>- `/tenants/{tenantId}/vehicles/{vehicleId}` GET/PUT/DELETE (archive payload supports note) | List with filters (search, company, status, sort, pagination). Create form requires `companyId` & `vin`, optional `plateNo`,`seatCount` (numeric parsing), `usage`,`status`. Detail pane enables edit with same fields, archive button (DELETE with optional note), and refresh. | Active tenant guard + mount guard; state persisted in `STORAGE_KEY_STATE`. i18n keys under `vehicles.*`, fallback to `errorGeneric` on failure. |
| Users (Roles & Sessions) | `#/users`<br>`frontend/users/routerAttach.ts` → `mountUsersPage` (`frontend/users/usersPage.ts`) | `frontend/users/users.api.ts` (`/api/users` list/get/create, `/api/users/{id}/assign`, `/api/users/{id}/revoke`, `/api/users/{id}/permissions`, `/api/users/{id}/roles/{role}` DELETE)<br>`frontend/users/roles.api.ts` (`/seed/roles`)<br>Shared DTOs in `frontend/users/types.ts`. | Two-column layout: user list (search, pagination, skip/take) with create form (email input). Detail pane shows metadata, sessions list (`sessions.length`, raw IDs), assign-role form (`role` select required, optional tenant claims + date range + PII level), revoke sessions button, permissions toggle (fetches allow list), role badge removal (calls delete). Validation ensures role selected, JSON parsing minimal (claims stored as comma-separated string). | Uses localStorage/cookie token for auth; no additional permission guard. i18n keys under `users.*`, `sessions*`, `claims*`; toaster messaging via `showToast`. Sessions count synced with list. |
| Approvals (Legacy) | Embedded within `modules/UserManagement/index.module.js` (imports `frontend/users/approvalsPage.ts`); rendered alongside legacy user table, no dedicated hash route | `frontend/users/api.ts` (`/approval/list`, `/approval/start`, `/approval/{id}/apply`), bearer auth from storage/cookie. | Simple form to trigger approvals (`op` and `tenantId` required, optional `targetId`), renders approval cards with approve button (fires `applyApproval`). Inline alerts for validation/errors; minimal styling. | Relies on `AppState` for current user info and translations (`frontend/users/i18n.ts`). No permission gating beyond API authorization. Should be folded into React Tenants/Users domain with shared approval hooks. |
| Audit Logs | `#/audit`<br>`frontend/audit/routerAttach.ts` → `mountAuditPage` (`frontend/audit/page.ts`, styles in `page.css`) | `frontend/audit/api.ts` (`/audit` list with filters, `/audit/{id}` detail, `/audit/export/csv` download) using bearer auth from localStorage. | Toolbar exposes filters (query, actorId, tenantId, action contains, status select, date range). Table renders paginated results, detail panel fetches record by id, CSV export button opens new tab. No explicit form validation (strings/numbers forwarded). | No permission wrapper; depends on token presence. Strings largely hard-coded (Turkish) → needs migration to `src/lib/i18n`. Candidate for shared `DataGrid`, `InlineFilterBar`, `DetailPanel` components in React. |

## Coverage Notes

- Remaining legacy sub-apps (`frontend/permissions`, `frontend/notifications`, `frontend/tasks`, `frontend/audit` subfeatures, `frontend/auth` login) still need the same level of inventory before their migration sprints.
- Legacy i18n keys are split between `frontend/i18n/index.ts` and compiled `frontend/dist/assets/index-*.js`; prepare extraction scripts before React-side consolidation.
- Active tenant state, localStorage keys, and custom DOM helpers (`frontend/ui/*`) should be mapped to new React equivalents (`src/lib/settings`, TanStack Query hooks, shared layouts).

## Legacy API Hooks (React)

Shared TanStack Query helpers for legacy endpoints live under `src/api/legacy/`:

- `legacyFetch(config)` wraps fetch, attaches auth token, tenant/company headers, handles timeouts, and normalizes legacy error payloads (`LegacyApiError`).
- `useLegacyQuery({ queryKey, path, params, ... })` provides a `useQuery` wrapper for GET-style operations.
- `useLegacyMutation({ request: { path, method, body } })` standardises POST/PUT/PATCH/DELETE calls while allowing custom mutationFns if needed.

All module migrations should route legacy API calls through these helpers before introducing module-specific client files (`src/api/tenants.ts`, etc.), so behaviour like auth headers, notifications on 401, and timeouts stay consistent across React pages.

## Shared React Layout Components

Reusable UI primitives under `src/features/common/` mirror the legacy CRUD ergonomics:

- `CrudLayout` arranges page headers, action buttons, filter bars, and an optional sticky detail column.
- `DataGrid` is a light wrapper around the existing `VirtualTable`, wiring TanStack tables into a styled list view.
- `DetailPanel` provides a right-hand card with sticky headers and optional footers for record metadata.
- `InlineFilterBar` standardises compact filter chips/toolbars for list pages.
- `FormDialog` wraps the project modal component to produce accessible create/edit dialogs with consistent buttons.

New feature modules should compose these building blocks so visuals and behaviour stay aligned while code redundancy is reduced.

## Feature Flags

- Set `VITE_USE_REACT_TENANTS=true` (or `1`) to enable the React-native tenants experience (`src/features/tenants/TenantsListPage.tsx`) instead of the legacy bridge during the transition.

## Migration Progress

- Tenants: React list + detail (identity history, identifiers, attachments, shareholdings, approvals) with inline identifier and shareholding creation is available behind `VITE_USE_REACT_TENANTS`.
- Officers, vehicle and driver assignments now support create/update/delete flows in React using the legacy API. Attachments and approvals remain tied to the legacy module until their React forms land (toasts are ready once they do).
